repos:
  - repo: https://github.com/astral-sh/uv-pre-commit
    rev: 0.9.8
    hooks:
      - id: uv-lock

  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.14.4
    hooks:
      # Run the formatter
      - id: ruff-format
      # Run the linter
      - id: ruff-check
        args: [--fix, --exit-non-zero-on-fix]

  - repo: local
    hooks:
      # Generate requirements.txt for Railway deployment
      - id: generate-requirements
        name: generate requirements.txt
        entry: bash -c 'uv pip compile pyproject.toml -o requirements.txt && git add requirements.txt'
        language: system
        files: ^(pyproject\.toml|uv\.lock)$
        pass_filenames: false

      # Type checking (uses uv run to access project venv)
      - id: pyright
        name: pyright
        entry: uv run pyright
        language: system
        types: [python]
        pass_filenames: false

      # Run all tests
      - id: pytest
        name: pytest
        entry: uv run pytest
        language: system
        types: [python]
        pass_filenames: false

# Notes:
# 1. `uv-lock` hook automatically updates the lockfile to ensure it matches specs in pyproject.toml
# 2. `ruff-format` runs before `ruff-check` (format then lint)
# 3. `--exit-non-zero-on-fix` flag blocks commits when ruff makes automatic fixes, must review first
# 4. `pyright` uses `uv run` to access project venv (required for third-party imports)
# 5. `pass_filenames: false` makes pytest run all tests rather than only testing modified files
# 6. `generate-requirements` auto-generates requirements.txt for Railway when pyproject.toml changes
